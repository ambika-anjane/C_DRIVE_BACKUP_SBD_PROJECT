1. CHECK FOR NULL VALUES FOR KEYS

select * from (select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY from  DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES 
where PRC_COMPTTR_SLS_KEY is not null and SRC_SYS_KEY IS NOT null and SRC_SYS_KEY = 'PROWL' ) 



-- check for flags
select CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
where SRC_SYS_KEY = 'PROWL' 

-- chck for flags and expiry date
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,min(EFF_DTE), max(EXPR_DTE),CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG
from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
group by PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG HAVING SRC_SYS_KEY = 'PROWL'

-- chk for currency and loaddts
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,ZONE3_LOD_DTE as LOADDTS,CRNCY_KEY,CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG
from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
group by PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,ZONE3_LOD_DTE,CRNCY_KEY,CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG HAVING SRC_SYS_KEY = 'PROWL'

-- check for brnad_lkey , sbu_lkey
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,BRAND_LKEY,SBU_LKEY
from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
group by PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,BRAND_LKEY,SBU_LKEY HAVING SRC_SYS_KEY = 'PROWL'


queries
-- prowl
select * from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES;


--prowl target
select COUNT(*) as "Target_Count" from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES WHERE SRC_SYS_KEY = 'PROWL' AND CURR_RCRD_FLAG ='N' OR ORP_RCRD_FLAG ='N' OR DEL_FROM_SRC_FLAG = 'N'
select COUNT(*)  from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES WHERE ISO_COUNTRY_CODE ='US'
select COUNT(*) as "Target_Count" from DEV_EDW.CONSOLIDATED_09282022.EDW_PRICING_COMPETITOR_SALES WHERE SRC_SYS_KEY = 'PROWL'  and DEL_FROM_SRC_FLAG is  null  

select 'CA', COUNT(*) AS ROW_CNT
from dev_raw.prowl.VW_PROWL_FULL_URL_LIST_CANADA WHERE REPORTS = 'Y'
UNION ALL
select 'US', COUNT(*) AS ROW_CNT
from dev_raw.prowl.VW_PROWL_FULL_URL_LIST_US WHERE REPORTS = 'Y';
SELECT COUNT(*) FROM DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES WHERE COUNTRY_ISO_CODE = 'US'
select COUNT(*) as "Target_Count" from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES WHERE SRC_SYS_KEY = 'PROWL'  and DEL_FROM_SRC_FLAG is  null  
show primary keys in DEV_EDW.CONSOLIDATED_09282022.EDW_PRICING_COMPETITOR_SALES
desc table DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES 
select * from (select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY from  DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES where PRC_COMPTTR_SLS_KEY is null and SRC_SYS_KEY is null) limit 2000
select * from (select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY from  DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES 
where PRC_COMPTTR_SLS_KEY is not null and SRC_SYS_KEY IS NOT null and SRC_SYS_KEY = 'PROWL' ) 

-- CHECK FOR DUPLICATES
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,COUNT(*) from  DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES 
where PRC_COMPTTR_SLS_KEY is not null and SRC_SYS_KEY IS NOT null and SRC_SYS_KEY = 'PROWL' GROUP BY 1,2

-- PROWL TARGET COUNT
select country_iso_code, count(*) AS TARGET_COUNT
from DEV_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
where SRC_SYS_KEY = 'PROWL'
group by 1
limit 10;
-- prowl source COUNT
select COUNT(*) as "Source_Count" from "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_CANADA" 
select COUNT(*) as "Source_Count" from "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_US" 

select EVENTDTS  from "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_US"
-- 45490 less in view
SELECT * FROM "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_CANADA_CHANGES" WHERE REPORTS = 'Y'
SELECT * FROM "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_US_CHANGES" 

select COUNT(*) as "Source_Count" from "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_CANADA"  WHERE REPORTS = 'Y'
select COUNT(*) as "Source_Count" from "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_US"  WHERE REPORTS = 'Y'


show primary keys in "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_CANADA"
desc table "PROD_RAW"."PROWL"."PROWL_FULL_URL_LIST_CANADA"
show primary keys in "DEV_RAW"."PROWL"."PROWL_FULL_URL_LIST_US"






select * from "DEV_EDW"."EDW_DBT_VIEWS"."EDW_PROWL_FULL_URL_LIST_CANADA_PRICING_COMPETITOR_SALES_VW"
select * from "DEV_EDW"."CONSOLIDATED_09282022"."EDW_PRICING_COMPETITOR_SALES" LIMIT 10000 
desc table "DEV_EDW"."CONSOLIDATED_09282022"."EDW_PRICING_COMPETITOR_SALES"


-- TEST DATABASE
 use database test_EDW
 select * from test_EDW.
 use schema CONSOLIDATED
 desc table "TEST_EDW"."CONSOLIDATED"."EDW_PRICING_COMPETITOR_SALES"
 SELECT COUNT(*) AS TARGETCOUNT FROM "TEST_EDW"."CONSOLIDATED"."EDW_PRICING_COMPETITOR_SALES" WHERE SRC_SYS_KEY = 'PROWL' 

SELECT COUNT(*) FROM "TEST_EDW"."CONSOLIDATED"."EDW_PRICING_COMPETITOR_SALES" WHERE SRC_SYS_KEY = 'PROWL' and  COUNTRY_ISO_CODE ='US'
SELECT COUNT(*) AS SOURCECOUNT FROM "TEST_EDW"."CONSOLIDATED"."EDW_PRICING_COMPETITOR_SALES" WHERE SRC_SYS_KEY = 'PROWL' and COUNTRY_ISO_CODE ='CANADA'
select count(*)  AS SOURCECOUNT from "TEST_RAW"."PROWL"."PROWL_FULL_URL_LIST_CANADA" where REPORTS = 'Y'
select count(*)  AS SOURCECOUNT from "TEST_RAW"."PROWL"."PROWL_FULL_URL_LIST_US" where REPORTS = 'Y'
show primary keys in "TEST_EDW"."CONSOLIDATED"."EDW_PRICING_COMPETITOR_SALES"
-- CHECK FOR NULL VALUES FOR KEYS
select * from (select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY from  TEST_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES 
where PRC_COMPTTR_SLS_KEY is not null and SRC_SYS_KEY IS NOT null and SRC_SYS_KEY = 'PROWL' ) 

-- CHECK FOR DUPLICATES
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,COUNT(*) from  TEST_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES 
where PRC_COMPTTR_SLS_KEY is not null and SRC_SYS_KEY IS NOT null and SRC_SYS_KEY = 'PROWL' GROUP BY 1,2

-- chck for flags and expiry date
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,min(EFF_DTE), max(EXPR_DTE),CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG
from TEST_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
group by PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG HAVING SRC_SYS_KEY = 'PROWL'
-- check for flags
select CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG from TEST_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
where SRC_SYS_KEY = 'PROWL' 

-- chk for currency and loaddts
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,ZONE3_LOD_DTE as LOADDTS,CRNCY_KEY,CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG
from TEST_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
group by PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,ZONE3_LOD_DTE,CRNCY_KEY,CURR_RCRD_FLAG,ORP_RCRD_FLAG,DEL_FROM_SRC_FLAG HAVING SRC_SYS_KEY = 'PROWL'

-- check for brnad_lkey , sbu_lkey
select PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,BRAND_LKEY,SBU_LKEY
from TEST_EDW.CONSOLIDATED.EDW_PRICING_COMPETITOR_SALES
group by PRC_COMPTTR_SLS_KEY,SRC_SYS_KEY,BRAND_LKEY,SBU_LKEY HAVING SRC_SYS_KEY = 'PROWL'

